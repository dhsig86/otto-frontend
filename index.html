<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OTTO ‚Ä¢ Triagem ORL</title>

  <!-- Tailwind (ok para GitHub Pages em dev) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Configura√ß√£o do backend (pode sobrescrever aqui se precisar) -->
  <script>
    window.ROB_BACKEND_API_URL = "https://otto-backend-otosig-aceeb4ea00e8.herokuapp.com";
  </script>

  <style>
    /* Chat bubbles */
    .bubble {
      max-width: 720px;
      border-radius: 12px;
      padding: .875rem 1rem;
      box-shadow: 0 1px 2px rgb(0 0 0 / 0.08);
      white-space: pre-wrap;
      line-height: 1.45;
    }
    .bubble-otto { background: #fff; border: 1px solid #e5e7eb; }
    .bubble-user { background: #0ea5e9; color: #fff; align-self: flex-end; }
    .msg { display: flex; gap: .75rem; margin-bottom: .75rem; }
    .msg .avatar {
      width: 36px; height: 36px; flex: none;
      border-radius: 9999px; background: #e0f2fe;
      display: grid; place-items: center; font-weight: 700; color: #0369a1;
    }
    .msg.user { justify-content: flex-end; }
    .msg.user .avatar { display: none; }
    .badge { font-size: .75rem; padding: .125rem .5rem; border-radius: 9999px; background:#f1f5f9; }
    .pill { border:1px solid #e5e7eb; border-radius:9999px; padding:.5rem .9rem; background:#fff; }
    .pill:disabled{opacity:.6; cursor:not-allowed;}
    .progress-bar { height:10px; border-radius:6px; background:#e5e7eb; overflow:hidden;}
    .progress-bar > div { height:100%; width:0; background:#16a34a; transition: width .25s ease; }
    dialog::backdrop { background: rgba(15, 23, 42, .35); }
    .modal-card { max-height: 80vh; overflow:auto; }
  </style>
</head>

<body class="bg-slate-50 text-slate-900">
  <!-- Header -->
  <header class="bg-gradient-to-r from-sky-600 to-indigo-600 text-white">
    <div class="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-full bg-white/20 grid place-items-center font-bold">ü§ñ</div>
        <div>
          <div class="text-xl font-semibold">OTTO</div>
          <div class="text-sm opacity-90">Triagem ORL</div>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <button id="btn-reset" class="pill text-sm bg-white/10 border-white/30 text-white hover:bg-white/20">Reiniciar</button>
        <button id="btn-dark" class="pill text-sm bg-white/10 border-white/30 text-white hover:bg-white/20">üåô</button>
      </div>
    </div>
  </header>

  <!-- Aviso -->
  <div class="bg-amber-100 text-amber-900 border-y border-amber-200">
    <div class="max-w-5xl mx-auto px-4 py-2 text-sm">
      Este assistente realiza triagem inicial e n√£o substitui consulta m√©dica.
    </div>
  </div>

  <!-- Conte√∫do -->
  <main class="max-w-5xl mx-auto px-4 py-4">
    <!-- Chat -->
    <section id="chat" class="flex flex-col gap-2 mb-3"></section>

    <!-- Barra de progresso -->
    <div class="progress-bar mb-3"><div id="progress-bar" style="width:0%"></div></div>

    <!-- Quick replies -->
    <div id="quick-replies" class="flex flex-wrap gap-2 mb-3"></div>

    <!-- Composer -->
    <div class="flex flex-col gap-3">
      <div class="flex flex-wrap gap-2">
        <button id="btn-review" class="pill">Revisar sintomas</button>
        <button id="btn-add-symptoms" class="pill">‚ûï Adicionar sintomas</button>
        <button id="btn-report" class="pill">üßæ Gerar relat√≥rio</button>
      </div>

      <div class="flex items-stretch gap-2">
        <input id="user-input" type="text" class="flex-1 rounded-lg border border-slate-300 px-3 py-3 bg-white"
               placeholder="Descreva o que sente..." autocomplete="off" />
        <button id="send-btn" class="px-5 rounded-lg bg-sky-600 text-white font-medium hover:bg-sky-700">Enviar</button>
      </div>
    </div>
  </main>

  <!-- LGPD -->
  <dialog id="lgpd-modal" class="w-full max-w-2xl rounded-xl p-0">
    <div class="modal-card p-6">
      <h2 class="text-xl font-semibold mb-2">Consentimento LGPD</h2>
      <p class="text-sm text-slate-700 mb-4">
        Finalidade: este servi√ßo realiza triagem inicial em Otorrinolaringologia para orientar a prioriza√ß√£o do atendimento.
        N√£o substitui consulta m√©dica.
      </p>
      <ul class="list-disc pl-6 text-sm text-slate-700 space-y-1 mb-4">
        <li><b>Dados coletados:</b> idade, sexo (biol√≥gico), sintomas, texto livre e sinais de alerta.</li>
        <li><b>Tratamento:</b> uso para gerar hip√≥teses e recomenda√ß√µes de conduta.</li>
      </ul>
      <label class="flex items-center gap-2 mb-4">
        <input id="lgpd-agree" type="checkbox" class="w-4 h-4">
        <span>Li e concordo com os termos de tratamento de dados.</span>
      </label>
      <div class="flex justify-end gap-2">
        <button id="lgpd-start" class="px-4 py-2 rounded-lg bg-sky-600 text-white disabled:opacity-50" disabled>Come√ßar</button>
      </div>
    </div>
  </dialog>

  <!-- Mini-intake (idade/sexo) -->
  <dialog id="intake-modal" class="w-full max-w-lg rounded-xl p-0">
    <div class="modal-card p-6">
      <h2 class="text-lg font-semibold mb-4">Antes de come√ßarmos</h2>
      <div class="mb-4">
        <label class="block text-sm font-medium mb-1">Idade (anos)</label>
        <input id="intake-age" type="number" min="0" max="120" class="w-full border rounded-lg px-3 py-2" placeholder="Ex.: 34">
      </div>
      <div class="mb-4">
        <div class="block text-sm font-medium mb-2">Sexo (biol√≥gico)</div>
        <div class="flex flex-wrap gap-4">
          <label class="flex items-center gap-2"><input type="radio" name="intake-sex" value="M"> Masculino</label>
          <label class="flex items-center gap-2"><input type="radio" name="intake-sex" value="F"> Feminino</label>
          <label class="flex items-center gap-2"><input type="radio" name="intake-sex" value="O"> Outro/Prefiro n√£o dizer</label>
        </div>
      </div>
      <div class="flex justify-between">
        <button id="intake-skip" class="px-3 py-2 rounded-lg border">Pular</button>
        <button id="intake-continue" class="px-4 py-2 rounded-lg bg-sky-600 text-white">Continuar</button>
      </div>
    </div>
  </dialog>

  <!-- Caixa √öNICA de sintomas -->
  <dialog id="symptom-modal" class="w-full max-w-3xl rounded-xl p-0">
    <div class="modal-card p-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold">Selecionar sintomas</h2>
        <button id="symptom-close" class="text-slate-500 hover:text-slate-700">‚úï</button>
      </div>

      <div class="grid md:grid-cols-2 gap-6">
        <!-- OUVIDO -->
        <div>
          <div class="font-medium mb-2">Ouvido</div>
          <div class="space-y-2">
            <label class="flex items-center gap-2"><input type="checkbox" data-symptom="dor_de_ouvido"> Dor de ouvido</label>
            <label class="flex items-center gap-2"><input type="checkbox" data-symptom="otorreia"> Secre√ß√£o no ouvido (otorreia)</label>
            <label class="flex items-center gap-2"><input type="checkbox" data-symptom="tinnitus"> Zumbido (tinnitus)</label>
            <label class="flex items-center gap-2"><input type="checkbox" data-symptom="hipoacusia"> Perda de audi√ß√£o</label>
            <label class="flex items-center gap-2"><input type="checkbox" data-symptom="vertigem"> Tontura/vertigem</label>
          </div>
        </div>

        <!-- NARIZ -->
        <div>
          <div class="font-medium mb-2">Nariz</div>
          <div class="space-y-2">
            <label class="flex items-center gap-2"><input type="checkbox" data-symptom="nariz_entupido"> Nariz entupido</label>
            <label class="flex items-center gap-2"><input type="checkbox" data-symptom="coriza"> Coriza/Catarro</label>
            <label class="flex items-center gap-2"><input type="checkbox" data-symptom="espirros"> Espirros</label>
            <label class="flex items-center gap-2"><input type="checkbox" data-symptom="epistaxe"> Sangramento nasal</label>
            <label class="flex items-center gap-2"><input type="checkbox" data-symptom="dor_face"> Dor de face/sinusite</label>
          </div>
        </div>

        <!-- GARGANTA (faringe) -->
        <div>
          <div class="font-medium mb-2">Garganta</div>
          <div class="space-y-2">
            <label class="flex items-center gap-2"><input type="checkbox" data-symptom="dor_de_garganta"> Dor de garganta</label>
            <label class="flex items-center gap-2"><input type="checkbox" data-symptom="placas_amigdalas"> Placas nas am√≠gdalas</label>
            <label class="flex items-center gap-2"><input type="checkbox" data-symptom="disfagia"> Dificuldade para engolir</label>
            <label class="flex items-center gap-2"><input type="checkbox" data-symptom="febre"> Febre</label>
            <label class="flex items-center gap-2"><input type="checkbox" data-symptom="tosse"> Tosse</label>
          </div>
        </div>

        <!-- LARINGE (voz) -->
        <div>
          <div class="font-medium mb-2">Laringe / Voz</div>
          <div class="space-y-2">
            <label class="flex items-center gap-2"><input type="checkbox" data-symptom="rouquidao"> Rouquid√£o / Sem voz</label>
            <label class="flex items-center gap-2"><input type="checkbox" data-symptom="voz_abafada"> Voz abafada</label>
            <label class="flex items-center gap-2"><input type="checkbox" data-symptom="dispneia_leve"> Falta de ar leve</label>
          </div>
        </div>
      </div>

      <div class="mt-6 flex items-center justify-between gap-3">
        <div class="text-xs text-slate-500">Selecione o que se aplica. Voc√™ pode tamb√©m descrever em texto livre.</div>
        <div class="flex gap-2">
          <button id="symptom-cancel" class="px-4 py-2 rounded-lg border">Cancelar</button>
          <button id="symptom-save" class="px-4 py-2 rounded-lg bg-sky-600 text-white">Salvar</button>
        </div>
      </div>
    </div>
  </dialog>

  <!-- Scripts (ordem IMPORTA) -->
  <script src="diagnostics.js"></script>
  <script src="robotto.js"></script>
  <script src="app-ui.js"></script>

  <script>
    // Inicializa√ß√£o m√≠nima dos modais (UI nativa do app-ui.js vai controlar)
    const lgpdModal = document.getElementById('lgpd-modal');
    const intakeModal = document.getElementById('intake-modal');
    const symptomModal = document.getElementById('symptom-modal');

    // Abre LGPD na primeira carga
    window.addEventListener('DOMContentLoaded', () => {
      if (lgpdModal && typeof lgpdModal.showModal === 'function') {
        lgpdModal.showModal();
      }
    });

    // LGPD: habilita bot√£o ao marcar
    const agree = document.getElementById('lgpd-agree');
    const start = document.getElementById('lgpd-start');
    if (agree && start) {
      agree.addEventListener('change', () => { start.disabled = !agree.checked; });
      start.addEventListener('click', () => {
        lgpdModal.close();
        if (intakeModal && typeof intakeModal.showModal === 'function') intakeModal.showModal();
      });
    }

    // Fechar modal de sintomas (o app-ui tamb√©m controla isso)
    document.getElementById('symptom-close')?.addEventListener('click', () => symptomModal.close());
    document.getElementById('symptom-cancel')?.addEventListener('click', () => symptomModal.close());
  </script>
</body>
</html>
<!-- ===================== End of index.html ===================== -->